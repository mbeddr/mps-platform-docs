---
comments: true
---

This page looks behind the hood of the startup process of MPS 2021.1.4 and newer. For most parts, similar code executes
for other MPS versions.

The application starts with [Launcher.java](https://github.com/JetBrains/MPS/blob/master/startup/src/jetbrains/mps/Launcher.java), setting some IntelliJ-specific properties, such as the file watcher path and the platform prefix, and collecting the plugin paths when running MPS from sources.
It then calls [Main.kt](https://github.com/JetBrains/intellij-community/blob/master/platform/bootstrap/src/com/intellij/idea/Main.kt), where it sets flags about the execution environment, such as the headless mode or if the application is invoked from the command line.
The system properties are also loaded and populated with data.
 [BootstrapClassLoaderUtil#initClassLoader()](https://github.com/JetBrains/intellij-community/blob/master/platform/bootstrap/src/com/intellij/idea/BootstrapClassLoaderUtil.java#L56) loads the class loader. Afterward, [MainImpl.kt](https://github.com/JetBrains/intellij-community/blob/master/platform/platform-main/src/com/intellij/idea/MainImpl.kt) is looked up
and executed. It mainly redirects the application's initialization to the [ApplicationLoader#initApplication](https://github.com/JetBrains/intellij-community/blob/master/platform/platform-impl/src/com/intellij/idea/ApplicationLoader.kt#L63) method.
The time from this method to `ApplicationLoader.run` is called *app initialization*. Here, the command line arguments are
first processed: a special method looks for `-Dkey=value` program arguments and stores some of them in system properties.
A task on the event dispatch thread initializes the GUI and loads system fonts. Plugins are also initialized
and loaded.

You can start MPS from MPS itself through [MPSEnvironment.java](https://github.com/JetBrains/MPS/blob/master/core/tool/environment/source_gen/jetbrains/mps/tool/environment/MpsEnvironment.java) or [IdeaEnvironment.java](https://github.com/JetBrains/MPS/blob/master/workbench/mps-platform/jetbrains.mps.ide.platform/source_gen/jetbrains/mps/tool/environment/IdeaEnvironment.java) from outside. [EnvironmentConfig](http://127.0.0.1:63320/node?ref=r%3A2876f1ee-0b45-4db5-8c09-0682cdee5c67%28jetbrains.mps.tool.environment%29%2F7413225496542992777) Both initialize both classes. It also lets you specify the plugins, macros, and libraries that should be loaded. In [IdeaEnvironment#createIdeaApplication](https://github.com/JetBrains/MPS/blob/master/workbench/mps-platform/jetbrains.mps.ide.platform/source_gen/jetbrains/mps/tool/environment/IdeaEnvironment.java#L157), some IntelliJ-specific properties are also set. Both environments can manage MPS projects (creating, opening, and closing them).

 For the integration with the IntelliJ platform, [MPSCoreComponents](https://github.com/JetBrains/MPS/blob/master/workbench/mps-platform/source/jetbrains/mps/ide/MPSCoreComponents.java) plays an important role: it contains references to the following core components:
 
- MPS platform with the base class [PlatformBase](https://github.com/JetBrains/MPS/blob/11da1e6afdcb2a174684ca1a9efaa611da7d3393/core/platform/src-full/jetbrains/mps/core/platform/PlatformBase.java)
- [PersistenceRegistry.java](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.persistence%28MPS.Core%2F%29%2F%7EPersistenceRegistry) as the core component implementation of [PersistenceFacade](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.persistence%28MPS.OpenAPI%2F%29%2F%7EPersistenceFacade). The PersistenceFacade represents a singleton registry of models, model root factories, find usages, and navigation participants.
  It also provides methods to transform strings to model refs/module refs/node IDs and vice versa.
- [LibraryInitializer.java](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library%28MPS.Core%2F%29%2F%7ELibraryInitializer), which manages [library](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library.contributor%28MPS.Core%2F%29%2F%7ELibraryContributor) contributions (loading, unloading, updating). It creates instances of [SLibrary](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library%28MPS.Core%2F%29%2F%7ESLibrary) for each path [RepositoryContributor#getPaths()](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library.contributor%28MPS.Core%2F%29%2F%7ERepositoryContributor.getPaths%2528%2529) returns. SLibrary tracks a path with modules inside. It listens to file system events and reloads modules from the disk if necessary.  It is the layer between [SRepository](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.module%28MPS.OpenAPI%2F%29%2F%7ESRepository) and [SModule](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.module%28MPS.OpenAPI%2F%29%2F%7ESModule) in the repository hierarchy (as well as the project).
  The repository consists of library modules, project modules, and several special modules.
- [ClassLoaderManager.java](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.classloading%28MPS.Core%2F%29%2F%7EClassLoaderManager) is responsible for loading classes within MPS.

## MPS Platform

The MPS platform contains so-called component plugins that are registered through PlatformBase:

- [MPSCore.java](https://github.com/JetBrains/MPS/blob/master/core/kernel/source/jetbrains/mps/core/platform/MPSCore.java), the core MPS functionality layer
- [MPSProjectValidation.java](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/core/platform/MPSProjectValidation.java), which provides validation code for project modules. It contains the following core checkers:
    - The [structure checker](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/project/validation/StructureChecker.java) inspects the structure aspect for errors (e.g., missing reference, properties)
    - [model properties checker](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/checkers/ModelPropertiesChecker.java) implemented in [ModelValidator.java](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/project/validation/ModelValidator.java)
    - [Module checker](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/checkers/ModuleChecker.java), which shows errors in the logical view
    - The [constraints checker](https://github.com/JetBrains/MPS/blob/master/core/project-check/source/jetbrains/mps/checkers/ConstraintsChecker.java) inspects parent/child, can be root/ancestor, and property constraints.
- [MPSMake.java](https://github.com/JetBrains/MPS/blob/master/core/make-runtime/solutions/jetbrains.mps.make/source_gen/jetbrains/mps/make/facets/MPSMake.java), which provides the components
    - [MakeServiceComponent](http://127.0.0.1:63320/node?ref=r%3Ab25dd364-bc3f-4a66-97d1-262009610c5e%28jetbrains.mps.make%29%2F5600956479087952114) gives access to the active facility to perform project make
    - [FacetRegistry](http://127.0.0.1:63320/node?ref=r%3A71895ceb-c89d-4545-aa38-89d1cd891f17%28jetbrains.mps.make.facet%29%2F6168415856807659069) provides methods for registering/unregistering and looking up [facades](https://www.jetbrains.com/help/mps/howto-integrating-into-the-mps-make-framework.html).
- [MPSTypechecking](https://github.com/JetBrains/MPS/blob/master/core/typechecking/source/jetbrains/mps/typechecking/internal/MPSTypechecking.java), which provides the components
    - [TypecheckingFacadeComponent](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typechecking.internal%28MPS.Core%2F%29%2F%7ETypecheckingFacadeComponent)
    - [LanguageScopeFactory](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.languageScope%28MPS.Core%2F%29%2F%7ELanguageScopeFactory) 
    - [TypecheckingBackend.java](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typechecking.backend%28MPS.Core%2F%29%2F%7ETypecheckingBackend) is used to install and uninstall [TypecheckingProvider](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typechecking.backend%28MPS.Core%2F%29%2F%7ETypecheckingProvider).
- [MPSTypesystem.java](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typesystem%28MPS.Core%2F%29%2F%7EMPSTypesystem), which provides the components
    - [TypeChecker](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typesystem.inference%28MPS.Core%2F%29%2F%7ETypeChecker)
    - [TypeContextManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typesystem.inference%28MPS.Core%2F%29%2F%7ETypeContextManager), a deprecated class that shouldn't be used anymore (use [TypecheckingFacade](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typechecking%28MPS.Core%2F%29%2F%7ETypecheckingFacade) instead)
- [MPSGenerator](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.typesystem.inference%28MPS.Core%2F%29%2F%7ETypeContextManager), which provides the components
    - [ModelGenerationStatusManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.generator%28MPS.Core%2F%29%2F%7EModelGenerationStatusManager) allows querying the generation status of models and listening to changes in the generated files through a [ModelGenerationStatusListener](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.generator%28MPS.Core%2F%29%2F%7EModelGenerationStatusListener).
    - [GenerationSettingsProvider](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.generator%28MPS.Core%2F%29%2F%7EGenerationSettingsProvider) manages the [generation settings](https://www.jetbrains.com/help/mps/generator.html).
    - [TraceRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.generator.trace%28MPS.Core%2F%29%2F%7ETraceRegistry), the entry component for the [generator trace](https://www.jetbrains.com/help/mps/generator-cookbook.html#canidebugthegenerationprocess?) mechanism
- [MPSFindUsages](https://github.com/JetBrains/MPS/blob/master/core/findUsages-runtime/source_gen/jetbrains/mps/ide/findusages/MPSFindUsages.java), which provides the components
    - [FindUsagesFacade](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.module%28MPS.OpenAPI%2F%29%2F%7EFindUsagesFacade), an effective (usually index-based) implementation of find usages routines.
    - [FindersManager](http://127.0.0.1:63320/node?ref=r%3A78f1dc30-d9c6-41ba-bc9c-1e73f8bda079%28jetbrains.mps.ide.findusages%29%2F8568892084424438073)
- [MPSTextGenerator](https://github.com/JetBrains/MPS/blob/master/core/textgen/source/jetbrains/mps/text/impl/MPSTextGenerator.java), which provides the component 
    - [TextGenSettings](https://github.com/JetBrains/MPS/blob/master/core/textgen/source/jetbrains/mps/text/TextGenSettings.java), the [settings](https://www.jetbrains.com/help/mps/generator.html#:~:text=in%20the%20generators.-,textgen%20options,-Fail%20if%20textgen) that are used by text generation
- [MPSFeedbackPlugin](https://github.com/JetBrains/MPS/blob/master/core/aspects/feedback/feedback-api/source/jetbrains/mps/core/aspects/feedback/api/MPSFeedbackPlugin.java), which provides the component
    - [FeedbackAspectRegistry](http://127.0.0.1:63320/node?ref=9e9ef4e2-decf-4e97-bf80-9109e8b759bb%2Fjava%3Ajetbrains.mps.core.aspects.feedback.api%28jetbrains.mps.lang.feedback.api%2F%29%2F%7EFeedbackAspectRegistry), which manages the descriptors of the [feedback language aspect](https://www.jetbrains.com/help/mps/feedback.html#feedbackaspect)

## MPSCore

This class provides the following core components:

- [LibraryInitializer](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library%28MPS.Core%2F%29%2F%7ELibraryInitializer), which manages [library](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.library.contributor%28MPS.Core%2F%29%2F%7ELibraryContributor) contributions (loading, unloading, updating)
- [PersistenceFacade](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.persistence%28MPS.OpenAPI%2F%29%2F%7EPersistenceFacade), which represents a singleton registry of models, model root factories, find usages, and navigation participants.
- [ClassLoaderManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.classloading%28MPS.Core%2F%29%2F%7EClassLoaderManager), which is responsible for loading classes within MPS
- [MPSModuleRepository](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.smodel%28MPS.Core%2F%29%2F%7EMPSModuleRepository) is a repository with modules visible in MPS. It is used by the class [ProjectRepository](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EProjectRepository).
- [LanguageRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.smodel.language%28MPS.Core%2F%29%2F%7ELanguageRegistry) manages languages and their generators.
- [ModelFactoryRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.extapi.persistence%28MPS.Core%2F%29%2F%7EModelFactoryRegistry) stores default associations between [ModelFactory](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.persistence%28MPS.OpenAPI%2F%29%2F%7EModelFactory) and [DataSourceType](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.persistence.datasource%28MPS.OpenAPI%2F%29%2F%7EDataSourceType) (many-to-many mapping). Examples of DataSourceTypes are the bundles' data source types *.mps*, *.model*, and *.mpsr*. The class also stores a mapping between model factory types and model factories, allowing users to replace the bundled persistence we provide.
- [SRepositoryRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.extapi.module%28MPS.Core%2F%29%2F%7ESRepositoryRegistry), which manages [SRepository](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.module%28MPS.OpenAPI%2F%29%2F%7ESRepository) instances (they are storages for modules)
- [FacetsFacade](http://127.0.0.1:63320/node?ref=8865b7a8-5271-43d3-884c-6fd1d9cfdd34%2Fjava%3Aorg.jetbrains.mps.openapi.module%28MPS.OpenAPI%2F%29%2F%7EFacetsFacade) manages language facades.
- [PathMacros](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EPathMacros) manages [path variables](https://www.jetbrains.com/help/mps/absolute-path-variables.html) and also some builtin macros such as *USER_HOME*, *MODULE_DIR*, *PROJECT_DIR*, *APPLICATION_PLUGINS_DIR*, and *MODULE_WORKING_DIR*.
- [ExtensionRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.smodel.language%28MPS.Core%2F%29%2F%7EExtensionRegistry), which manages extensions populated by classes loaded from compiled and deployed modules
- [ConceptRegistry](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.smodel.language%28MPS.Core%2F%29%2F%7EConceptRegistry) manages concept descriptors.
- [DataSourceFactoryRuleService](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.extapi.persistence.datasource%28MPS.Core%2F%29%2F%7EDataSourceFactoryRuleService), which is a service provider for defining own data source factories
- [DescriptorIOFacade](http://127.0.0.1:63320/node?ref=r%3Ac7bbaee3-030a-4940-995f-2174babaf670%28jetbrains.mps.project.io%29%2F557142600900286111), which returns [DescriptorIO](http://127.0.0.1:63320/node?ref=r%3Ac7bbaee3-030a-4940-995f-2174babaf670%28jetbrains.mps.project.io%29%2F557142600900286148) instances that are responsible for reading and writing descriptors to/from a file
- [ModelsAutoImportsManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EModelsAutoImportsManager) manages [AutoImportContributor](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EModelsAutoImportsManager%24AutoImportsContributor). Classes that extend this class can automatically add languages to a model. For example, [TestsModelAutoImports](https://github.com/JetBrains/MPS/blob/master/workbench/mps-workbench/source/jetbrains/mps/ide/project/listener/TestsModelAutoImports.java) automatically adds the languages *jetbrains.mps.lang.test* and *jetbrains.mps.baseLanguage.unitTest* to test models.
- [VFSManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.vfs%28MPS.Core%2F%29%2F%7EVFSManager) is an entry point to access various file system protocols available in MPS. [Virtual File System - IntelliJ Platform Plugin SDK](https://plugins.jetbrains.com/docs/intellij/virtual-file-system.html) contains More information about VFS.
- [ProjectManager](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EProjectManager) manages MPS projects. You can receive events sent while opening and closing a project through a [ProjectManagerListener](http://127.0.0.1:63320/node?ref=6ed54515-acc8-4d1e-a16c-9fd6cfe951ea%2Fjava%3Ajetbrains.mps.project%28MPS.Core%2F%29%2F%7EProjectManagerListener).